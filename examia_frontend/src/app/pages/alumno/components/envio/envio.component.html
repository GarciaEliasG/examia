<header class="topbar">
  <div class="brand">
    <img src="assets/images/logo.png" alt="Logo Examia" class="logo">
  </div>
</header>

<main class="wrap">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading">
    <p>üîÑ Cargando datos del env√≠o...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading" class="error">
    <p>‚ùå {{ error }}</p>
    <button class="btn primary" (click)="loadEnvioData()">Reintentar</button>
  </div>

  <!-- Success State -->
  <div *ngIf="examen && !isLoading">
    <div class="header-row">
      <button class="icon-btn back" aria-label="Volver" (click)="volver()">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M14 7l-5 5 5 5V7z"/></svg>
      </button>
      <h1 class="title">Mi Env√≠o: {{ examen.titulo }}</h1>
    </div>
    
    <p class="subtitle">
      Materia: {{ examen.materia }} ‚Ä¢ 
      Entregado: {{ formatFecha(examen.fecha_realizacion) }} ‚Ä¢ 
      Estado: {{ examen.estado === 'pendiente' ? 'Pendiente de correcci√≥n' : examen.estado }}
    </p>

    <form class="questions-form disabled-view">
      <!-- Preguntas DIN√ÅMICAS -->
      <section *ngFor="let pregunta of examen.preguntas; let i = index" class="question-card">
        <p class="q-title">Pregunta {{ i + 1 }}:</p>
        <p class="q-text">{{ pregunta.enunciado }}</p>
        
        <!-- Respuesta de Desarrollo/Texto -->
        <div *ngIf="pregunta.tipo === 'desarrollo' || pregunta.tipo === 'texto'" class="q-options text-answer">
          <label for="q{{pregunta.id}}">Tu respuesta enviada:</label>
          <textarea 
            id="q{{pregunta.id}}" 
            name="q{{pregunta.id}}" 
            disabled
            class="respuesta-texto">{{ pregunta.respuesta || 'Sin respuesta' }}</textarea>
        </div>

        <!-- Opci√≥n M√∫ltiple -->
        <div *ngIf="pregunta.tipo === 'multiple_choice'" class="q-options multiple-choice">
          <div class="opcion-info">
            <strong>Opci√≥n seleccionada:</strong> {{ pregunta.opcionSeleccionada ? 'Opci√≥n ' + pregunta.opcionSeleccionada : 'No seleccionada' }}
          </div>
          <label class="option selected-sent">
            <input type="radio" [name]="'q' + pregunta.id" [value]="pregunta.opcionSeleccionada" checked disabled>
            <span class="option-text">Respuesta enviada</span>
          </label>
        </div>

        <!-- Archivo Adjunto -->
        <div *ngIf="pregunta.tipo === 'archivo'" class="q-options archivo-answer">
          <label>Archivo enviado:</label>
          <div class="attachment-preview">
            <span>{{ getFileIcon('pdf') }}</span>
            <p>{{ pregunta.respuesta || 'archivo_adjunto.pdf' }}</p>
            <a [href]="pregunta.respuesta" class="btn ghost small" target="_blank">Descargar</a>
          </div>
        </div>

        <p class="tipo-pregunta"><small>Tipo: {{ getTipoPregunta(pregunta.tipo) }}</small></p>
      </section>

      <!-- Archivos Adjuntos Globales -->
      <section *ngIf="attachments.length > 0" class="question-card attachments-card">
        <p class="q-title">Archivos Adjuntos Enviados:</p>
        <p class="q-text">El alumno adjunt√≥ los siguientes archivos ({{ attachments.length }}).</p>
        
        <div class="attachment-list">
          <div *ngFor="let attachment of attachments" class="attachment-item">
            <span>{{ getFileIcon(attachment.type) }}</span>
            <p>{{ attachment.name }}</p>
            <a [href]="attachment.downloadUrl" class="btn ghost small">Descargar</a>
          </div>
        </div>
      </section>

      <!-- Sin archivos -->
      <section *ngIf="attachments.length === 0" class="question-card">
        <p class="q-title">Archivos Adjuntos:</p>
        <p class="q-text">No se adjuntaron archivos adicionales en este env√≠o.</p>
      </section>
    </form>
  </div>
</main>