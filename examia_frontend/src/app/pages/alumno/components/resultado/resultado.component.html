<header class="topbar">
    <div class="brand">
        <img src="assets/images/logo.png" alt="Logo Examia" class="logo">
    </div>
</header>

<main class="wrap">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading">
    <p>üîÑ Cargando resultados...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading" class="error">
    <p>‚ùå {{ error }}</p>
    <button class="btn primary" (click)="loadResults()">Reintentar</button>
  </div>

  <!-- Success State -->
  <div *ngIf="examen && !isLoading">
    <div class="header-row">
        <button class="icon-btn back" aria-label="Volver" (click)="volver()">
            <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M14 7l-5 5 5 5V7z"/>
            </svg>
        </button>
        <h1 class="title">Resultado: {{ examen.titulo }}</h1>
    </div>
  
    <section class="result-summary">
      <div class="score-box">
        <p class="score-label">Calificaci√≥n Final</p>
        <span class="score">{{ examen.calificacion_final.toFixed(2) }}</span>
        <p class="status">{{ getEstadoTexto(examen.calificacion_final, examen.puntaje_maximo) }}</p>
      </div>
      <div class="meta-data">
        <p><strong>Materia:</strong> {{ examen.materia }}</p>
        <p><strong>Docente:</strong> {{ examen.docente }}</p>
        <p><strong>Fecha de correcci√≥n:</strong> {{ formatFecha(examen.fecha_correccion) }}</p>
        <p><strong>Tiempo de resoluci√≥n:</strong> {{ examen.tiempo_resolucion }}</p>
        <p><strong>Puntaje m√°ximo:</strong> {{ examen.puntaje_maximo }}</p>
        
        <button 
          class="btn primary full-width" 
          (click)="viewFeedback()"
          [disabled]="!tieneRetroalimentacion()">
          Ver Retroalimentaci√≥n Detallada
        </button>
      </div>
    </section>

    <section class="question-list">
      <h2>Detalle por Pregunta ({{ examen.preguntas.length }})</h2>

      <div *ngFor="let question of examen.preguntas; let i = index" 
           [class]="'q-result-item ' + question.estado">
        <div class="q-icon">{{ getStatusIcon(question.estado) }}</div>
        <div class="q-content">
          <p class="q-text">
            <strong>Pregunta {{ i + 1 }}:</strong> {{ question.enunciado }} 
            <span>({{ question.tipo }})</span>
          </p>
          <p class="feedback" *ngIf="question.respuesta_alumno">
            <strong>Tu respuesta:</strong> {{ question.respuesta_alumno }}
          </p>
          <p class="feedback" *ngIf="!question.respuesta_alumno">
            <strong>Tu respuesta:</strong> Sin respuesta
          </p>
          <p class="retroalimentacion" *ngIf="question.retroalimentacion">
            <strong>Comentario:</strong> {{ question.retroalimentacion }}
          </p>
        </div>
        <span class="q-score">
          {{ question.puntaje_obtenido.toFixed(2) }} / {{ question.puntaje_maximo.toFixed(2) }}
        </span>
      </div>

      <!-- Estado vac√≠o -->
      <div *ngIf="examen.preguntas.length === 0" class="empty-state">
        <p>No hay preguntas para mostrar en este resultado.</p>
      </div>
    </section>
  </div>
</main>